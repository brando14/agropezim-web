!function(){var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},a={},o=e.parcelRequire3642;null==o&&((o=function(e){if(e in t)return t[e].exports;if(e in a){let o=a[e];delete a[e];let l={id:e,exports:{}};return t[e]=l,o.call(l.exports,l,l.exports),l.exports}var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){a[e]=t},e.parcelRequire3642=o);var l;l={defaultLocale:"en",supportedLocales:["cs","de","en","es","fi","fr","hu","it","ja","nb","nl","pl","pt-BR","ru","sv","th","tr","uk","vi","zh-Hans","zh-Hant"],resourceUrl:"./strings/".concat("7e06ccae9821","/{locale}.json")};var n,c,r=o("unafd"),s=o("IYGjQ"),i=(c=o("2iUxv"))&&c.__esModule?c:{default:c};var d={},u=function(e){return e&&e.__esModule?e:{default:e}}(o("2iUxv"));s=o("IYGjQ");var h,m=function(e){return e&&e.__esModule?e:{default:e}}(o("2iUxv"));s=o("IYGjQ");h={chooseTeam:e=>t=>s.myTeams(t,!1).then((a=>{if(!a||0===a.length)return t.popup({title:t.localizeKey("authorize"),url:"./authorize.html",callback:t=>t.get("board","private","selected-slack").then((a=>e(t,{id:a})))});const o=a.map((a=>m.default.extend(a,{text:a.name,callback:o=>t.set("board","private","selected-slack",a.id).then((()=>e(o,a)))}))),l={text:"Add Slack Team",callback:t=>t.popup({title:t.localizeKey("authorize"),url:"./authorize.html",callback:t=>t.get("board","private","selected-slack").then((a=>e(t,{id:a})))}),alwaysVisible:!0};return o.push(l),t.popup({items:o,title:t.localizeKey("choose_slack_team"),search:{count:15}})}))};const p=TrelloPowerUp.Promise,f={},_={},g=(e,t)=>a=>p.join(a.get("board","private","selected-slack"),s.myTeams(a,!1)).spread(((o,l)=>{if(!l||0===l.length)return a.popup({title:a.localizeKey("authorize"),url:"./authorize.html",callback:g(e,t)}),null;if(o){const e=u.default.find(l,["id",o]);if(e)return e}return l[0]})).then((o=>{if(!o)return null;if(f[o.id])return f[o.id];if(_[o.id])return p.resolve(a.popup({items:_[o.id],title:a.localizeKey("choose_a_channel"),search:{count:15,placeholder:a.localizeKey("search_for_a_channel"),empty:a.localizeKey("no_channels_found")}}));const l=p.join(s.getChannels(a,o.id,!0,!0),s.getGroups(a,o.id,!0),s.getStars(a,o.id)).spread(((l,n,c)=>{let r=[];const s=l.map((t=>u.default.extend(t,{text:"#".concat(t.name),callback:a=>e(a,t,o)})));r=r.concat(s);const i=u.default.filter(n,["is_mpim",!1]).map((t=>u.default.extend(t,{text:"#".concat(t.name),callback:a=>e(a,t,o)})));t||(r=r.concat(i)),r=r.sort(((e,t)=>u.default.find(c,["channel",e.id])&&!u.default.find(c,["channel",t.id])?-1:!u.default.find(c,["channel",e.id])&&u.default.find(c,["channel",t.id])?1:e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0));const d={text:a.localizeKey("choose_a_different_team"),callback:h.chooseTeam(g(e,t)),alwaysVisible:!0};return r.push(d),_[o.id]=r,f[o.id]=null,a.popup({items:r,title:a.localizeKey("choose_a_channel"),search:{count:15,placeholder:a.localizeKey("search_for_a_channel"),empty:a.localizeKey("no_channels_found")}})}));return f[o.id]=l,l}));d={chooseChannel:g};var y={},k=function(e){return e&&e.__esModule?e:{default:e}}(o("2iUxv"));s=o("IYGjQ");const b=TrelloPowerUp.Promise,z=e=>t=>b.join(t.get("board","private","selected-slack"),s.myTeams(t,!1)).spread(((a,o)=>{if(!o||0===o.length)return t.popup({title:t.localizeKey("authorize"),url:"./authorize.html",callback:z(e)}),null;if(a){const e=k.default.find(o,["id",a]);if(e)return e}return o[0]})).then((a=>a?s.getMembers(t,a.id).then((o=>{const l=o.map((t=>{const o=t.real_name?"@".concat(t.name," (").concat(t.real_name,")"):"@".concat(t.name);return k.default.extend(t,{text:o,callback:o=>e(o,t,a)})})),n={text:t.localizeKey("choose_a_different_team"),callback:h.chooseTeam(z(e)),alwaysVisible:!0};return l.push(n),t.popup({items:l,title:t.localizeKey("choose_user_ellipsis"),search:{count:15,placeholder:t.localizeKey("search_for_a_user"),empty:t.localizeKey("no_users_found")}})})):null));y={choosePerson:z};var v=o("79Byh"),w=(s=o("IYGjQ"),o("77woC"));const x=(e,t)=>w.sendUIEvent({action:"clicked",actionSubject:"button",actionSubjectId:t,source:"cardDetailScreen"},e),K=(e,t,a)=>e.card("id").then((o=>s.sendCard(e,o.id,a.id,t.id).then((()=>{if(/^C/.test(t.id)){let o=i.default.pick(t,["id","name","is_archived"]);o=i.default.extend(o,{team:i.default.pick(a,["id","domain"])}),e.set("board","private","last-channel",o)}e.popup({title:e.localizeKey("message_sent"),url:"message-sent.html",args:{target:t,team:a}})})))),U=(e,t)=>a=>a.popup({title:a.localizeKey("choose_a_time"),url:"choose-time.html",args:{target:e,team:t}}),S=(e,t,a)=>{const o=e.localizeKeys(["three_minutes","ten_minutes","one_hour","three_hours","one_day","two_days","three_days","seven_days","fourteen_days","thirty_days"]);return e.popup({title:"me"===t.name?e.localizeKey("remind_you_when"):e.localizeKey("remind_name_when",{name:t.name}),items:[{text:e.localizeKey("choose_a_time_ellipsis"),callback:U(t,a)}].concat(["3 minutes","10 minutes","1 hour","3 hours","1 day","2 days","3 days","7 days","14 days","30 days"].map(((l,n)=>({text:e.localizeKey("remind_in_interval",{interval:o[n]}),callback:v(t,a,"in ".concat(l))}))))})},T=(e,t)=>S(e,{name:"me",id:"me"},t);n=e=>e.get("board","private","last-channel").then((t=>{const a=[];return x(e,"slackPowerUpCardButton"),t&&i.default.isObject(t)&&i.default.isString(t.name)&&a.push({text:e.localizeKey("send_to_specific_channel",{channel:t.name}),callback:a=>s.myTeams(a,!1).then((o=>i.default.find(o,["id",t.team.id])?K(a,t,t.team):a.popup({title:e.localizeKey("authorize"),url:"./authorize.html",callback:e=>e.back()})))}),a.push({text:e.localizeKey("send_to_channel"),callback:e=>(x(e,"slackPowerUpSendToChannelButton"),d.chooseChannel(K)(e))}),a.push({text:e.localizeKey("send_via_direct_message"),callback:e=>(x(e,"slackPowerUpSendDMButton"),y.choosePerson(K)(e))}),a.push({text:e.localizeKey("attach_conversation_ellipsis"),callback:e=>(x(e,"slackPowerUpAttachConversationButton"),(e=>e.popup({title:e.localizeKey("attach_conversation"),url:"attach-conversation.html"}))(e))}),a.push({text:e.localizeKey("remind_me_about_card"),callback:e=>(x(e,"slackPowerUpRemindMeButton"),h.chooseTeam(T)(e))}),a.push({text:e.localizeKey("remind_someone_about_card"),callback:e=>(x(e,"slackPowerUpRemindSomeoneButton"),y.choosePerson(S)(e))}),a.push({text:e.localizeKey("remind_channel_about_card"),callback:e=>(x(e,"slackPowerUpRemindChannelButton"),d.chooseChannel(S,!0)(e))}),e.popup({items:a,title:e.localizeKey("slack")})}));var P={};const j=e=>{const t={url:e},a=/^https:\/\/([a-z0-9-]+)\.slack\.com\/([^#?]*)/.exec(e);if(!a)return t;t.isSlack=!0,t.subdomain=a[1];const o=a[2];if(!o)return t;const l=o.split("/");return"archives"===l[0]&&(t.channel=l[1],t.timestamp=(/^p(\d{10})(\d{6})$/.exec(l[2])||[]).slice(1).join("."),t.isMessage=!!t.timestamp),t};P={parse:j,isSlack:e=>j(e).isSlack,isMessage:e=>j(e).isMessage};var C;C=(e,t)=>e.length>t?"".concat(e.slice(0,t).replace(/\s*\S+$/,""),"â€¦"):e;w=o("77woC");const M={accentColor:"#425381",url:"settings.html",fullscreen:!1,title:"Slack",height:188},N="./images/icon.svg",{Promise:I}=TrelloPowerUp,{sha256Digest:L}=TrelloPowerUp.util.crypto;TrelloPowerUp.initialize({"attachment-sections":(e,t)=>{const a=t.entries.filter((e=>P.isMessage(e.url)));return 0===a.length?[]:(w.sendUIEvent({action:"viewed",actionSubject:"section",actionSubjectId:"slackPowerUpSection",source:"cardDetailScreen"},e),[{claimed:a,icon:N,title:e.localizeKey("slack_conversations"),content:{type:"iframe",url:e.signUrl("./messages.html"),height:64}}])},"board-buttons":e=>(I.join(e.get("organization","private","token"),e.get("board","shared","token")).spread(((t,a)=>{t&&(console.log("Migrating team level token"),s.linkUser(e,t).then((()=>e.remove("organization","private","token")))),a&&(console.log("Migrating board level token"),s.linkUser(e.boardToken).then((()=>e.remove("board","private","token"))))})),[{icon:N,text:e.localizeKey("slack"),callback:t=>{w.sendUIEvent({action:"clicked",actionSubject:"button",actionSubjectId:"slackPowerUpBoardButton",source:"boardScreen"},e),t.modal(M)}}]),"card-buttons":e=>[{icon:N,text:e.localizeKey("slack"),callback:n}],"card-from-url":(e,t)=>{const{url:a}=t;if(!P.isMessage(t.url))throw e.NotHandled("Not a Slack message URL");return s.dataForUrl(e,a,!0).catch((()=>{throw e.NotHandled("Error getting data for URL")})).then((t=>{if(t&&t.formatted)return{name:C(t.formatted,128),desc:t.formatted};if(t&&t.messages.length>0){const o=t.messages[0].text||t.messages[0].attachments[0].fallback;return r.getMessageText(e,o,t).then((async e=>{try{const t=await L(a);localStorage.setItem("slack:url:".concat(t),e)}catch(e){}return{name:C(e,128),desc:e}})).catch((()=>{throw e.NotHandled("Error formatting message")}))}throw e.NotHandled("No data for URL")}))},"format-url":(e,t)=>{if(!P.isMessage(t.url))throw e.NotHandled("Not a Slack message URL");const a=/archives\/(.*)\//g.exec(t.url)[1];return/^[D|G]/g.test(a)?{text:t.url,icon:N}:s.dataForUrl(e,t.url,!0).catch((()=>{throw e.NotHandled("Error getting data for URL")})).then((a=>{if(a&&a.formatted)return{text:C(a.formatted,128),icon:N};if(a&&a.messages.length>0){const o=a.messages[0].text||a.messages[0].attachments[0].fallback;return r.getMessageText(e,o,a).then((async e=>{try{const a=await L(t.url);localStorage.setItem("slack:url:".concat(a),e)}catch(e){}return{text:C(e,128),icon:N}})).catch((()=>{throw e.NotHandled("Error formatting message")}))}throw e.NotHandled("No data for URL")}))},"show-settings":e=>e.modal(M)},{targetOrigin:"https://trello.com",localization:l,Sentry:window.Sentry})}();
//# sourceMappingURL=index.8790c604.js.map
